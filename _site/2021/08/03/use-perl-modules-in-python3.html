<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>use perl modules in python3 | http/japh.se</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="use perl modules in python3" />
<meta name="author" content="Magnus Woldrich" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Imagine this:" />
<meta property="og:description" content="Imagine this:" />
<link rel="canonical" href="https://japh.se/2021/08/03/use-perl-modules-in-python3.html" />
<meta property="og:url" content="https://japh.se/2021/08/03/use-perl-modules-in-python3.html" />
<meta property="og:site_name" content="http/japh.se" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-03T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="use perl modules in python3" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Magnus Woldrich"},"dateModified":"2021-08-03T00:00:00+02:00","datePublished":"2021-08-03T00:00:00+02:00","description":"Imagine this:","headline":"use perl modules in python3","mainEntityOfPage":{"@type":"WebPage","@id":"https://japh.se/2021/08/03/use-perl-modules-in-python3.html"},"url":"https://japh.se/2021/08/03/use-perl-modules-in-python3.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://japh.se/feed.xml" title="http/japh.se" />
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NP8ENWFZ64"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NP8ENWFZ64');
</script>

  <body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">http/japh.se </a>
    
    <meta property="og:image" content="http://i.japh.se/social.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="406">
    <meta property="og:image:height" content="246"><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>

        <a href="/dev">code</a>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">use perl modules in python3</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-08-03T00:00:00+02:00" itemprop="datePublished">Aug 3, 2021
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Magnus Woldrich</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Imagine this:</p>

<p>You’re a seasoned perl veteran that for one reason or another needs to
write some python. You’re not very good at it, though you’re enjoying it
more than what you initially thought. Some things in python are easier,
some things are harder, and many things are just different.</p>

<p>You’ve done a fair amount of work on your perl modules over at <a href="https://metacpan.org/author/WOLDRICH">metacpan</a>,
and you <strong>use</strong> functionality imported from them in many new projects.</p>

<p>While learning the language by writing <a href="https://github.com/trapd00r/beets-tcp">plugins</a> for
<a href="https://github.com/beetbox/beets/">beets</a>, you stumble upon a whole
bunch of open issues on that project regarding <a href="https://github.com/beetbox/beets/issues/1593">UI
overhaul</a>.</p>

<p>During long music import sessions there’s so much info spewed out in the
terminal; it would really help with a sprinkle of color and
reformatting.</p>

<p>I’ve written <a href="https://metacpan.org/pod/Term::ExtendedColor">quite</a> a
<a href="https://metacpan.org/pod/Term::ExtendedColor::Xresources">few</a> perl
modules <a href="https://metacpan.org/pod/File::LsColor">dealing with colors</a> in
different ways and I know all there is to know about escape sequences,
terminal emulators and various quirks.</p>

<p>A first step to add some color to the beets import process could be to
color the imported filenames according to the users
<a href="https://github.com/trapd00r/LS_COLORS">LS_COLORS</a> environment variable.
That would add familiarity and remove the need to watch out for file
extensions in the long outputs beets produces.</p>

<p>I’ve seen my <a href="https://metacpan.org/pod/File::LsColor">File::LsColor</a>
project cloned in a variety of languages such as
<a href="https://github.com/sharkdp/lscolors">rust</a> and ruby, so I went over to <a href="https://pypi.org/search/?q=ls+colors">pypi</a> for something
similar.</p>

<p><strong>There’s no such thing.</strong></p>

<p>Well. I could rewrite File::LsColor in python3 myself, but that’s not
what I wanted to spend time on <strong>right now</strong>.</p>
<h3 id="what-if-i-could-mix-perl-and-python">What if I could mix perl and python…</h3>

<p>Now, there’s all kinds of
<a href="https://metacpan.org/search?size=20&amp;q=inline%3A%3A">Inline::</a> modules
on cpan that gives the ability to write perl subroutines in
another language, such as <a href="https://metacpan.org/dist/Inline-C/view/lib/Inline/C.pod">C</a> or <a href="https://metacpan.org/dist/Inline-Python/view/Python.pod">python</a>.
But what about writing <strong>python functions in perl</strong>?</p>

<p>There’s a <a href="https://metacpan.org/dist/Inline-Python/view/Python.pod#Using-
Perl-inside-Python-(inside-Perl)">note</a> in Inline::Python but to me, it’s not
very clear whether this actually works…</p>

<p>However; there is a thing called <a href="https://github.com-
/shlomif/pyperl/blob/master/perlmodule.pod">pyperl/perlmodule</a> that was originally created
by ActiveState in the early 2000’s. There’s loads of (mis)information
regarding it not functioning with python3, but let’s try it out.</p>

<p><strong>Install the pyperl package:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cpan pyperl
</code></pre></div></div>

<p>Start by importing the perl module, here aptly named japh.
Let’s also grab some arguments from python:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">perl</span> <span class="k">as</span> <span class="n">japh</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span>
</code></pre></div></div>

<p>Create a perl subroutine using <strong>perl.eval()</strong>. For a return to work
properly, you need to omit the actual return.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">basename_and_colorize</span> <span class="o">=</span> <span class="n">japh</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="s">"""
  sub {
    use File::Basename;
    use File::LsColor qw(ls_color);

    my $file = shift;
    ls_color(basename($file));
  }
"""</span><span class="p">)</span>
</code></pre></div></div>

<p>Use python to iterate over the given argments, and for each argument,
call the perl subroutine using <strong>perl.call()</strong>, and store it in a
python variable.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
  <span class="n">base</span> <span class="o">=</span> <span class="n">japh</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">basename_and_colorize</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</code></pre></div></div>

<p>Execute the script with a few arguments:</p>

<p><img src="/assets/perlinpython3.png" alt="perlinpython" /></p>

<p>Well, look at that!</p>

<p>Now, I guess I must say one shouldn’t be doing this in production,
yadda, yadda, but remember, the question shouldn’t be <em>why</em>, but
always <em>how</em>. If nothing else, this could make for faster proofs of concepts.</p>

<p>Here’s a <a href="https://github.com/trapd00r/perlinpython3">link</a> to the example code repository.</p>

  </div><a class="u-url" href="/2021/08/03/use-perl-modules-in-python3.html" hidden></a>
</article>


<!--      <a href="https://paypal.me/trapd00r"><img src="/assets/paypal.svg" alt="Donate"></a> -->

      </div>


    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

<!--    <h2 class="footer-heading">http/japh.se</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">http/japh.se</li><li><a class="u-email" href="mailto:m@japh.se">m@japh.se</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/trapd00r"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">trapd00r</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>rss</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>just another {perl,} hacker</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
